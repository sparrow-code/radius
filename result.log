[2025-04-13 03:44:17] Setting file permissions...
[2025-04-13 03:44:17] Using user/group: freerad for permissions
[2025-04-13 03:44:18] Restarting FreeRADIUS service...
Job for freeradius.service failed because the control process exited with error code.
See "systemctl status freeradius.service" and "journalctl -xeu freeradius.service" for details.
[2025-04-13 03:44:21] ERROR: FreeRADIUS service failed to start. Running diagnostics...
● freeradius.service - FreeRADIUS multi-protocol policy server
     Loaded: loaded (/lib/systemd/system/freeradius.service; enabled; vendor preset: enabled)
     Active: activating (auto-restart) (Result: exit-code) since Sun 2025-04-13 03:44:18 IST; 3s ago
       Docs: man:radiusd(8)
             man:radiusd.conf(5)
             http://wiki.freeradius.org/
             http://networkradius.com/doc/
    Process: 17148 ExecStartPre=/usr/sbin/freeradius $FREERADIUS_OPTIONS -Cx -lstdout (code=exited, status=1/FAILURE)
        CPU: 219ms
[2025-04-13 03:44:21] Checking for common issues...
[2025-04-13 03:44:21] Checking if ports 1812 and 1813 are already in use...
Ports are available
[2025-04-13 03:44:21] Starting FreeRADIUS in debug mode for diagnostics...
FreeRADIUS Version 3.0.26
Copyright (C) 1999-2021 The FreeRADIUS server project and contributors
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE
You may redistribute copies of FreeRADIUS under the terms of the
GNU General Public License
For more information about these matters, see the file named COPYRIGHT
Starting - reading configuration files ...
including dictionary file /usr/share/freeradius/dictionary
including dictionary file /usr/share/freeradius/dictionary.dhcp
including dictionary file /usr/share/freeradius/dictionary.vqp
including dictionary file /etc/freeradius/3.0/dictionary
including configuration file /etc/freeradius/3.0/radiusd.conf
including configuration file /etc/freeradius/3.0/proxy.conf
including configuration file /etc/freeradius/3.0/clients.conf
including files in directory /etc/freeradius/3.0/mods-enabled/
including configuration file /etc/freeradius/3.0/mods-enabled/digest
including configuration file /etc/freeradius/3.0/mods-enabled/expiration
including configuration file /etc/freeradius/3.0/mods-enabled/soh
including configuration file /etc/freeradius/3.0/mods-enabled/detail.log
including configuration file /etc/freeradius/3.0/mods-enabled/pap
including configuration file /etc/freeradius/3.0/mods-enabled/utf8
including configuration file /etc/freeradius/3.0/mods-enabled/linelog
including configuration file /etc/freeradius/3.0/mods-enabled/always
including configuration file /etc/freeradius/3.0/mods-enabled/ntlm_auth
including configuration file /etc/freeradius/3.0/mods-enabled/expr
including configuration file /etc/freeradius/3.0/mods-enabled/preprocess
including configuration file /etc/freeradius/3.0/mods-enabled/attr_filter
including configuration file /etc/freeradius/3.0/mods-enabled/detail
including configuration file /etc/freeradius/3.0/mods-enabled/files
including configuration file /etc/freeradius/3.0/mods-enabled/sql
including configuration file /etc/freeradius/3.0/mods-enabled/realm
including configuration file /etc/freeradius/3.0/mods-enabled/passwd
including configuration file /etc/freeradius/3.0/mods-enabled/dynamic_clients
including configuration file /etc/freeradius/3.0/mods-enabled/chap
including configuration file /etc/freeradius/3.0/mods-enabled/radutmp
including configuration file /etc/freeradius/3.0/mods-enabled/unpack
including configuration file /etc/freeradius/3.0/mods-enabled/logintime
including configuration file /etc/freeradius/3.0/mods-enabled/unix
including configuration file /etc/freeradius/3.0/mods-enabled/cache_eap
including configuration file /etc/freeradius/3.0/mods-enabled/sradutmp
including configuration file /etc/freeradius/3.0/mods-enabled/echo
including configuration file /etc/freeradius/3.0/mods-enabled/mschap
including configuration file /etc/freeradius/3.0/mods-enabled/replicate
including configuration file /etc/freeradius/3.0/mods-enabled/exec
including configuration file /etc/freeradius/3.0/mods-enabled/eap
including files in directory /etc/freeradius/3.0/policy.d/
including configuration file /etc/freeradius/3.0/policy.d/dhcp
including configuration file /etc/freeradius/3.0/policy.d/debug
including configuration file /etc/freeradius/3.0/policy.d/moonshot-targeted-ids
including configuration file /etc/freeradius/3.0/policy.d/abfab-tr
including configuration file /etc/freeradius/3.0/policy.d/filter
including configuration file /etc/freeradius/3.0/policy.d/cui
including configuration file /etc/freeradius/3.0/policy.d/openvpn
/etc/freeradius/3.0/policy.d/openvpn[19]: Expecting section start brace '{' after "reject Invalid username format"
Errors reading or parsing /etc/freeradius/3.0/radiusd.conf
sdworlld@0qKKkjgGSCulmW8XMW2t:~/isp/radius$








sdworlld@0qKKkjgGSCulmW8XMW2t:~/isp/radius$ sudo bash radius_manager.sh diagnostics

=== FreeRADIUS Diagnostics ===

[2025-04-13 03:45:11] Checking FreeRADIUS installation...
FreeRADIUS: INSTALLED
   freeradius ( 3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4 )
   freeradius-common ( 3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4 )
   freeradius-config ( 3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4 )
   freeradius-postgresql ( 3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4 )
   freeradius-utils ( 3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4 )
   libfreeradius3 ( 3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4 )

=== FreeRADIUS Service Status ===

Status: INACTIVE
     Active: activating (auto-restart) (Result: exit-code) since Sun 2025-04-13 03:45:06 IST; 4s ago
[2025-04-13 03:45:11] Checking configuration files...
Configuration directory: /etc/freeradius/3.0
  clients.conf: OK
  radiusd.conf: OK
  mods-available/sql: OK
  mods-enabled/sql: OK
  sites-available/default: OK
  sites-enabled/default: OK

=== Database Connection ===

[2025-04-13 03:45:11] Testing PostgreSQL connection...
[2025-04-13 03:45:11] PostgreSQL connection successful. Database 'radius' exists.
[2025-04-13 03:45:11] Database has 8 tables.

Checking critical tables:
  radcheck: OK
  radreply: OK
  radgroupcheck: OK
  radgroupreply: OK
  radusergroup: OK
  radacct: OK
  nas: OK
[2025-04-13 03:45:12] Checking log files...
Log file: /var/log/radius/radius.log

Last 5 errors in log file:
[2025-04-13 03:45:12] Checking for common issues...
[2025-04-13 03:45:12] Checking OpenVPN integration...
OpenVPN: ACTIVE
OpenVPN RADIUS client: CONFIGURED
OpenVPN RADIUS plugin: NOT CONFIGURED




sdworlld@0qKKkjgGSCulmW8XMW2t:~/isp/radius$ sudo bash radius_manager.sh fix

=== Fix Common Issues ===

[2025-04-13 03:46:17] Running diagnostics to identify issues...
[2025-04-13 03:46:17] WARNING: FreeRADIUS service is not running.
[2025-04-13 03:46:18] Checking and fixing permissions...
[2025-04-13 03:46:18] Running comprehensive fix script...
Do you want to run the comprehensive fix script? This will attempt to repair the entire installation. [y/N]: y
[2025-04-13 03:46:23] Detected Linux distribution: ubuntu 22.04
[2025-04-13 03:46:23] Checking if FreeRADIUS is installed...
[2025-04-13 03:46:23] Stopping FreeRADIUS service...
[2025-04-13 03:46:23] Checking existing OpenVPN installation...
[2025-04-13 03:46:23] OpenVPN service is active
[2025-04-13 03:46:23] OpenVPN server IP detected as: 10.8.0.1
[2025-04-13 03:46:23] Cleaning up broken installation...
[2025-04-13 03:46:23] Creating backup of existing configuration...
[2025-04-13 03:46:23] Removing FreeRADIUS packages...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages were automatically installed and are no longer required:
  freetds-common libct4 libdbi-perl libtalloc2 libtevent0 libwbclient0
Use 'sudo apt autoremove' to remove them.
The following packages will be REMOVED:
  freeradius freeradius-common freeradius-config freeradius-postgresql freeradius-utils libfreeradius3
0 upgraded, 0 newly installed, 6 to remove and 284 not upgraded.
After this operation, 5,873 kB disk space will be freed.
(Reading database ... 127359 files and directories currently installed.)
Removing freeradius-postgresql (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Removing freeradius (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Removing freeradius-utils (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Removing freeradius-config (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Removing freeradius-common (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Removing libfreeradius3 (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Processing triggers for man-db (2.10.2-1) ...
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following packages will be REMOVED:
  freetds-common libct4 libdbi-perl libtalloc2 libtevent0 libwbclient0
0 upgraded, 0 newly installed, 6 to remove and 284 not upgraded.
After this operation, 3,743 kB disk space will be freed.
(Reading database ... 126788 files and directories currently installed.)
Removing libct4:amd64 (1.3.6-1) ...
Removing freetds-common (1.3.6-1) ...
Removing libdbi-perl:amd64 (1.643-3build3) ...
Removing libwbclient0:amd64 (2:4.15.13+dfsg-0ubuntu1.6) ...
Removing libtevent0:amd64 (0.11.0-1build1) ...
Removing libtalloc2:amd64 (2.3.3-2build1) ...
Processing triggers for man-db (2.10.2-1) ...
Processing triggers for libc-bin (2.35-0ubuntu3.1) ...

[2025-04-13 03:47:04] Reinstalling FreeRADIUS packages...
Hit:1 http://de.archive.ubuntu.com/ubuntu jammy InRelease
Hit:2 http://de.archive.ubuntu.com/ubuntu jammy-updates InRelease
Hit:3 http://de.archive.ubuntu.com/ubuntu jammy-backports InRelease
Hit:4 http://de.archive.ubuntu.com/ubuntu jammy-security InRelease
Reading package lists... Done
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
The following additional packages will be installed:
  freeradius-common freeradius-config freetds-common libct4 libdbi-perl libfreeradius3 libtalloc2 libtevent0 libwbclient0
Suggested packages:
  freeradius-krb5 freeradius-ldap freeradius-mysql freeradius-python3 snmp libclone-perl libmldbm-perl libnet-daemon-perl libsql-statement-perl
The following NEW packages will be installed:
  freeradius freeradius-common freeradius-config freeradius-postgresql freeradius-utils freetds-common libct4 libdbi-perl libfreeradius3 libtalloc2
  libtevent0 libwbclient0
0 upgraded, 12 newly installed, 0 to remove and 284 not upgraded.
Need to get 0 B/2,658 kB of archives.
After this operation, 9,615 kB of additional disk space will be used.
Selecting previously unselected package libtalloc2:amd64.
(Reading database ... 126587 files and directories currently installed.)
Preparing to unpack .../00-libtalloc2_2.3.3-2build1_amd64.deb ...
Unpacking libtalloc2:amd64 (2.3.3-2build1) ...
Selecting previously unselected package libtevent0:amd64.
Preparing to unpack .../01-libtevent0_0.11.0-1build1_amd64.deb ...
Unpacking libtevent0:amd64 (0.11.0-1build1) ...
Selecting previously unselected package libwbclient0:amd64.
Preparing to unpack .../02-libwbclient0_2%3a4.15.13+dfsg-0ubuntu1.6_amd64.deb ...
Unpacking libwbclient0:amd64 (2:4.15.13+dfsg-0ubuntu1.6) ...
Selecting previously unselected package freeradius-common.
Preparing to unpack .../03-freeradius-common_3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4_all.deb ...
Unpacking freeradius-common (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Selecting previously unselected package freeradius-config.
Preparing to unpack .../04-freeradius-config_3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4_amd64.deb ...
Unpacking freeradius-config (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Selecting previously unselected package libfreeradius3.
Preparing to unpack .../05-libfreeradius3_3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4_amd64.deb ...
Unpacking libfreeradius3 (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Selecting previously unselected package freetds-common.
Preparing to unpack .../06-freetds-common_1.3.6-1_all.deb ...
Unpacking freetds-common (1.3.6-1) ...
Selecting previously unselected package libct4:amd64.
Preparing to unpack .../07-libct4_1.3.6-1_amd64.deb ...
Unpacking libct4:amd64 (1.3.6-1) ...
Selecting previously unselected package freeradius.
Preparing to unpack .../08-freeradius_3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4_amd64.deb ...
Unpacking freeradius (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Selecting previously unselected package freeradius-postgresql.
Preparing to unpack .../09-freeradius-postgresql_3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4_amd64.deb ...
Unpacking freeradius-postgresql (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Selecting previously unselected package freeradius-utils.
Preparing to unpack .../10-freeradius-utils_3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4_amd64.deb ...
Unpacking freeradius-utils (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Selecting previously unselected package libdbi-perl:amd64.
Preparing to unpack .../11-libdbi-perl_1.643-3build3_amd64.deb ...
Unpacking libdbi-perl:amd64 (1.643-3build3) ...
Setting up libtalloc2:amd64 (2.3.3-2build1) ...
Setting up libtevent0:amd64 (0.11.0-1build1) ...
Setting up freeradius-common (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Setting up freetds-common (1.3.6-1) ...
Setting up libdbi-perl:amd64 (1.643-3build3) ...
Setting up libfreeradius3 (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Setting up libwbclient0:amd64 (2:4.15.13+dfsg-0ubuntu1.6) ...
Setting up libct4:amd64 (1.3.6-1) ...
Setting up freeradius-config (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Setting up freeradius (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Setting up freeradius-postgresql (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
freeradius.service is not active, cannot reload.
invoke-rc.d: initscript freeradius, action "force-reload" failed.
Setting up freeradius-utils (3.0.26~dfsg~git20220223.1.00ed0241fa-0ubuntu3.4) ...
Processing triggers for man-db (2.10.2-1) ...
Processing triggers for libc-bin (2.35-0ubuntu3.1) ...
Scanning processes...
Scanning linux images...

Running kernel seems to be up-to-date.

No services need to be restarted.

No containers need to be restarted.

No user sessions are running outdated binaries.

No VM guests are running outdated hypervisor (qemu) binaries on this host.
[2025-04-13 03:47:33] Verifying directory structure...
[2025-04-13 03:47:33] Setting up PostgreSQL database for FreeRADIUS...
Synchronizing state of postgresql.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable postgresql
[2025-04-13 03:47:36] PostgreSQL user 'radius' already exists.
[2025-04-13 03:47:36] PostgreSQL database 'radius' already exists.
[2025-04-13 03:47:36] Importing schema to PostgreSQL database...
[2025-04-13 03:47:36] Found schema file at /etc/freeradius/3.0/mods-config/sql/dhcp/postgresql/schema.sql
[2025-04-13 03:47:36] Database schema already exists. Skipping import.
[2025-04-13 03:47:36] Configuring PostgreSQL authentication (pg_hba.conf)...
[2025-04-13 03:47:36] PostgreSQL hba configuration file: /etc/postgresql/14/main/pg_hba.conf
[2025-04-13 03:47:36] Found modules directory at /etc/freeradius/3.0/mods-available
[2025-04-13 03:47:36] Creating SQL module configuration...
[2025-04-13 03:47:36] Enabling SQL module...
[2025-04-13 03:47:36] Updating default site configuration...
[2025-04-13 03:47:36] Updating inner-tunnel site configuration...
[2025-04-13 03:47:36] Configuring RADIUS for OpenVPN integration...
[2025-04-13 03:47:36] Creating OpenVPN policy...
[2025-04-13 03:47:36] Checking clients configuration...
[2025-04-13 03:47:36] Adding test user to PostgreSQL database...
DELETE 1
INSERT 0 1
[2025-04-13 03:47:37] Setting file permissions...
[2025-04-13 03:47:37] Using user/group: freerad for permissions
[2025-04-13 03:47:38] Restarting FreeRADIUS service...
Job for freeradius.service failed because the control process exited with error code.
See "systemctl status freeradius.service" and "journalctl -xeu freeradius.service" for details.
[2025-04-13 03:47:41] ERROR: FreeRADIUS service failed to start. Running diagnostics...
● freeradius.service - FreeRADIUS multi-protocol policy server
     Loaded: loaded (/lib/systemd/system/freeradius.service; enabled; vendor preset: enabled)
     Active: activating (auto-restart) (Result: exit-code) since Sun 2025-04-13 03:47:38 IST; 3s ago
       Docs: man:radiusd(8)
             man:radiusd.conf(5)
             http://wiki.freeradius.org/
             http://networkradius.com/doc/
    Process: 19653 ExecStartPre=/usr/sbin/freeradius $FREERADIUS_OPTIONS -Cx -lstdout (code=exited, status=1/FAILURE)
        CPU: 184ms
[2025-04-13 03:47:41] Checking for common issues...
[2025-04-13 03:47:41] Checking if ports 1812 and 1813 are already in use...
Ports are available
[2025-04-13 03:47:41] Starting FreeRADIUS in debug mode for diagnostics...
FreeRADIUS Version 3.0.26
Copyright (C) 1999-2021 The FreeRADIUS server project and contributors
There is NO warranty; not even for MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE
You may redistribute copies of FreeRADIUS under the terms of the
GNU General Public License
For more information about these matters, see the file named COPYRIGHT
Starting - reading configuration files ...
including dictionary file /usr/share/freeradius/dictionary
including dictionary file /usr/share/freeradius/dictionary.dhcp
including dictionary file /usr/share/freeradius/dictionary.vqp
including dictionary file /etc/freeradius/3.0/dictionary
including configuration file /etc/freeradius/3.0/radiusd.conf
including configuration file /etc/freeradius/3.0/proxy.conf
including configuration file /etc/freeradius/3.0/clients.conf
including files in directory /etc/freeradius/3.0/mods-enabled/
including configuration file /etc/freeradius/3.0/mods-enabled/digest
including configuration file /etc/freeradius/3.0/mods-enabled/expiration
including configuration file /etc/freeradius/3.0/mods-enabled/soh
including configuration file /etc/freeradius/3.0/mods-enabled/detail.log
including configuration file /etc/freeradius/3.0/mods-enabled/pap
including configuration file /etc/freeradius/3.0/mods-enabled/utf8
including configuration file /etc/freeradius/3.0/mods-enabled/linelog
including configuration file /etc/freeradius/3.0/mods-enabled/always
including configuration file /etc/freeradius/3.0/mods-enabled/ntlm_auth
including configuration file /etc/freeradius/3.0/mods-enabled/expr
including configuration file /etc/freeradius/3.0/mods-enabled/preprocess
including configuration file /etc/freeradius/3.0/mods-enabled/attr_filter
including configuration file /etc/freeradius/3.0/mods-enabled/detail
including configuration file /etc/freeradius/3.0/mods-enabled/files
including configuration file /etc/freeradius/3.0/mods-enabled/sql
including configuration file /etc/freeradius/3.0/mods-enabled/realm
including configuration file /etc/freeradius/3.0/mods-enabled/passwd
including configuration file /etc/freeradius/3.0/mods-enabled/dynamic_clients
including configuration file /etc/freeradius/3.0/mods-enabled/chap
including configuration file /etc/freeradius/3.0/mods-enabled/radutmp
including configuration file /etc/freeradius/3.0/mods-enabled/unpack
including configuration file /etc/freeradius/3.0/mods-enabled/logintime
including configuration file /etc/freeradius/3.0/mods-enabled/unix
including configuration file /etc/freeradius/3.0/mods-enabled/cache_eap
including configuration file /etc/freeradius/3.0/mods-enabled/sradutmp
including configuration file /etc/freeradius/3.0/mods-enabled/echo
including configuration file /etc/freeradius/3.0/mods-enabled/mschap
including configuration file /etc/freeradius/3.0/mods-enabled/replicate
including configuration file /etc/freeradius/3.0/mods-enabled/exec
including configuration file /etc/freeradius/3.0/mods-enabled/eap
including files in directory /etc/freeradius/3.0/policy.d/
including configuration file /etc/freeradius/3.0/policy.d/dhcp
including configuration file /etc/freeradius/3.0/policy.d/debug
including configuration file /etc/freeradius/3.0/policy.d/moonshot-targeted-ids
including configuration file /etc/freeradius/3.0/policy.d/abfab-tr
including configuration file /etc/freeradius/3.0/policy.d/filter
including configuration file /etc/freeradius/3.0/policy.d/cui
including configuration file /etc/freeradius/3.0/policy.d/openvpn
/etc/freeradius/3.0/policy.d/openvpn[19]: Expecting section start brace '{' after "reject Invalid username format"
Errors reading or parsing /etc/freeradius/3.0/radiusd.conf